# Second Mind -- Progress Log
# Append-only. Each iteration writes what was built, learned, and gotchas.

## SM-001: Discovery and environment verification
- Node.js: v25.6.0 (>= 20 ✓)
- npm: 11.9.0 ✓
- Supabase CLI: 2.75.0 ✓
- Docker: 29.2.0, running ✓
- Starting repo files: README.md, prd.json, prompt.md, progress.txt, second-mind-spec.md, preflight.sh, .git/, .claude/
- This is a greenfield project — no app code exists yet
- Architecture confirmed from spec: Next.js App Router, Supabase + pgvector, Anthropic Claude API, Tailwind CSS
- Key decisions: Cmd+K command bar UI, memory files as markdown briefing docs, LLM-based context routing, warm "paper feel" aesthetic
- No code changes made (discovery only)

## SM-002: Project scaffolding
- Scaffolded Next.js 16.1.6 with App Router, TypeScript strict mode, Tailwind v4
- Warm neutral palette configured via CSS variables: background #faf8f5, foreground #1a1a1a, muted #6b6b6b, accent #e8e4df, border #d4d0cb
- Tailwind v4 uses @theme inline in CSS instead of tailwind.config.ts
- Created directories: lib/, components/, app/api/, types/, scripts/
- Landing page renders "Second Mind" text
- npm run build succeeds with zero errors
- All pre-existing files preserved
- Gotcha: Tailwind v4 config is CSS-based, not JS/TS config file based

## SM-003: Supabase local setup and client utilities
- Initialized Supabase with npx supabase init (config.toml created)
- Installed @supabase/supabase-js and @supabase/ssr
- Created lib/supabase/server.ts (createServerClient using service role key)
- Created lib/supabase/client.ts (createBrowserClient using anon key)
- Created middleware.ts for session refresh
- Created GET /api/health returning { status: ok, db: true } / { status: error, db: false }
- Supabase local starts OK, health check confirmed working
- Gotcha: Next.js 16 deprecates middleware.ts in favor of proxy convention (still works)
- Gotcha: Health check must not depend on tables existing (use schema cache error detection)

## SM-004: Database schema for memory files and versions
- Created migration 20260211000001_memory_files.sql
- memory_files table with uuid pk, filename unique, description, content, version, updated_at
- memory_file_versions table with fk to memory_files (cascade delete)
- npx supabase db reset succeeds
- Verified insert auto-generates uuid and timestamp
- Gotcha: psql not available locally, use docker exec to query

## SM-005: Artifacts, pending updates, and tasks tables
- Created migration 20260211000002_artifacts_tasks.sql
- Enabled pgvector extension
- Created artifacts, pending_memory_updates, tasks tables
- Created indexes: ivfflat on embedding, gin FTS on title+content+summary, partial indexes on status
- Note: ivfflat index warns about little data on empty table (normal)

## SM-006: Shared TypeScript types
- Generated types/supabase.ts from local schema via supabase gen types
- Created types/models.ts with MemoryFile, MemoryFileVersion, Artifact, PendingMemoryUpdate, Task
- Created types/api.ts with CommandRequest, CommandResponse, RouterResult, etc.
- All union types defined: ArtifactType, TaskStatus, UpdateStatus, CommandIntent
- No 'any' types anywhere
- Gotcha: supabase gen types includes a stderr line "Connecting to db 5432" that must be stripped from output

## SM-007: Seed memory files
- Created scripts/seed-memory.ts with 5 memory files: Gaurav, Taste, Reading, Travel, Ideas
- Each has realistic content with H2 sections and example entries
- Idempotent via upsert on filename
- Requires env vars exported before running (not auto-loaded from .env.local)

## SM-008: Memory file API routes
- GET /api/memory returns list without content (lightweight)
- GET /api/memory/[filename] returns full file with content
- PATCH /api/memory/[filename] saves version history, increments version, updates content
- Proper 404 for nonexistent files, 400 for missing content
- All routes use server Supabase client